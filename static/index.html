<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Quantum Random Generator</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-900 text-white min-h-screen flex flex-col items-center p-6">
  <h1 class="text-3xl font-bold mb-6 text-center" id="title">Quantum True Random Generator</h1>

  <div class="flex flex-wrap justify-center gap-4 w-full max-w-3xl">
    <div class="w-full md:w-auto">
      <label for="lang" class="block mb-1">Language:</label>
      <select id="lang" class="p-2 text-black rounded">
        <option value="en">English</option>
        <option value="ru">–†—É—Å—Å–∫–∏–π</option>
      </select>
    </div>

    <div class="w-full md:w-auto">
      <label for="mode" class="block mb-1" id="mode_label">
        Mode: <span title="Limited Range ‚Äì generates values in a range. Infinite ‚Äì one large bit-length number.">‚ùì</span>
      </label>
      <select id="mode" class="p-2 text-black rounded">
        <option value="limited">Limited Range</option>
        <option value="infinite">Infinite (bit-size)</option>
      </select>
    </div>

    <div id="limited_fields" class="flex flex-wrap gap-2">
      <div>
        <label for="min" class="block text-sm" id="min_label">Min:</label>
        <input id="min" class="p-2 text-black rounded" type="number" value="0" placeholder="Min" title="Minimum value" />
      </div>
      <div>
        <label for="max" class="block text-sm" id="max_label">Max:</label>
        <input id="max" class="p-2 text-black rounded" type="number" value="10000" placeholder="Max" title="Maximum value" />
      </div>
      <div>
        <label for="count" class="block text-sm" id="count_label">Count:</label>
        <input id="count" class="p-2 text-black rounded" type="number" value="10" placeholder="Count" title="How many numbers" />
      </div>
    </div>

    <div id="infinite_fields" class="hidden">
      <label id="bits_label">Bit length:</label>
      <input id="bitLength" type="range" min="8" max="4096" step="8" value="128" class="w-full" />
      <span id="bitValue" class="ml-2">128</span> <span id="bit_text">bits</span>
    </div>

    <div class="w-full md:w-auto">
      <label id="format_label" class="block mb-1">Format:</label>
      <select id="format" class="p-2 text-black rounded">
        <option value="dec">Decimal</option>
        <option value="hex">Hex</option>
        <option value="bin">Binary</option>
        <option value="base64">Base64</option>
      </select>
    </div>
  </div>

  <div class="w-full max-w-3xl mt-4 flex flex-wrap items-center gap-4">
    <label class="flex items-center">
      <input type="checkbox" id="strictValidation" checked class="mr-2" />
      <span id="strict_label">Strict Validation</span>
      <span title="If enabled, results must meet entropy and compression standards.">‚ùó</span>
    </label>
    <label>
      <span id="minEntropy_label">Min Entropy:</span>
      <input id="minEntropy" type="number" value="7.0" step="0.1" min="0" max="8" class="p-1 rounded text-black w-20 ml-1" title="Minimum entropy threshold. Max 8 bits/byte = perfect randomness." />
    </label>
    <label>
      <span id="maxCompression_label">Max Compression:</span>
      <input id="maxCompression" type="number" value="1.3" step="0.1" min="1" max="10" class="p-1 rounded text-black w-24 ml-1" title="Max allowed compression ratio. Lower = more random." />
    </label>

    <button onclick="generate()" id="generate_btn" class="bg-blue-600 hover:bg-blue-700 px-6 py-2 rounded text-white">
      Generate
    </button>
  </div>

<div class="w-full max-w-4xl mt-8">
    <h2 class="text-xl font-semibold mb-2">Output</h2>
    <pre id="output" class="bg-black p-4 rounded overflow-auto whitespace-pre-wrap"></pre>
    <button onclick="exportResult()" class="mt-2 bg-green-600 hover:bg-green-700 px-4 py-1 rounded">
      üíæ Download JSON
    </button>
  </div>

  <div class="w-full max-w-4xl mt-10">
    <h2 class="text-xl font-semibold mb-2">Distribution</h2>
    <canvas id="histogram" height="100"></canvas>
  </div>

  <script>
    const translations = {
      ru: {
        title: "–ö–≤–∞–Ω—Ç–æ–≤—ã–π –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∏—Å—Ç–∏–Ω–Ω–æ–π —Å–ª—É—á–∞–π–Ω–æ—Å—Ç–∏",
        mode_label: "–†–µ–∂–∏–º:",
        bits_label: "–î–ª–∏–Ω–∞ (–±–∏—Ç):",
        bit_text: "–±–∏—Ç",
        format_label: "–§–æ—Ä–º–∞—Ç:",
        generate_btn: "–ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å",
        strict_label: "–°—Ç—Ä–æ–≥–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞",
        minEntropy_label: "–ú–∏–Ω. —ç–Ω—Ç—Ä–æ–ø–∏—è:",
        maxCompression_label: "–ú–∞–∫—Å. —Å–∂–∞—Ç–∏–µ:",
        min_label: "–ú–∏–Ω:",
        max_label: "–ú–∞–∫—Å:",
        count_label: "–ö–æ–ª-–≤–æ:",
        tooltips: {
          min: "–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–∏–∞–ø–∞–∑–æ–Ω–∞",
          max: "–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–∏–∞–ø–∞–∑–æ–Ω–∞",
          count: "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–Ω–∞—á–µ–Ω–∏–π –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (–¥–æ 2048)",
          strict: "–ï—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ, –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –æ—Ç–∫–ª–æ–Ω–µ–Ω—ã, –µ—Å–ª–∏ –æ–Ω–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å–ª—É—á–∞–π–Ω—ã."
        }
      },
      en: {
        title: "Quantum True Random Generator",
        mode_label: "Mode:",
        bits_label: "Bit length:",
        bit_text: "bits",
        format_label: "Format:",
        generate_btn: "Generate",
        strict_label: "Strict Validation",
        minEntropy_label: "Min Entropy:",
        maxCompression_label: "Max Compression:",
        min_label: "Min:",
        max_label: "Max:",
        count_label: "Count:",
        tooltips: {
          min: "Minimum value in the range",
          max: "Maximum value in the range",
          count: "How many random numbers to generate (up to 2048)",
          strict: "If enabled, results must meet entropy and compression standards."
        }
      }
    };

    function setLanguage(lang) {
      localStorage.setItem("lang", lang);
      for (const key in translations[lang]) {
        if (key !== "tooltips") {
          const el = document.getElementById(key);
          if (el) el.innerText = translations[lang][key];
        }
      }
      document.getElementById("min").title = translations[lang].tooltips.min;
      document.getElementById("max").title = translations[lang].tooltips.max;
      document.getElementById("count").title = translations[lang].tooltips.count;
      document.getElementById("strictValidation").title = translations[lang].tooltips.strict;
    }

    function saveSettings() {
      localStorage.setItem("strict", document.getElementById("strictValidation").checked);
      localStorage.setItem("minEntropy", document.getElementById("minEntropy").value);
      localStorage.setItem("maxCompression", document.getElementById("maxCompression").value);
    }

    function loadSettings() {
      const savedLang = localStorage.getItem("lang") || "en";
      document.getElementById("lang").value = savedLang;
      setLanguage(savedLang);

      const strict = localStorage.getItem("strict") === "true";
      document.getElementById("strictValidation").checked = strict;
      const minEnt = localStorage.getItem("minEntropy");
      const maxComp = localStorage.getItem("maxCompression");
      if (minEnt) document.getElementById("minEntropy").value = minEnt;
      if (maxComp) document.getElementById("maxCompression").value = maxComp;
    }

    document.getElementById("lang").onchange = (e) => setLanguage(e.target.value);
    document.querySelectorAll("#strictValidation, #minEntropy, #maxCompression").forEach(el => {
      el.onchange = saveSettings;
    });
    document.getElementById("mode").onchange = function () {
      document.getElementById("limited_fields").classList.toggle("hidden", this.value !== "limited");
      document.getElementById("infinite_fields").classList.toggle("hidden", this.value !== "infinite");
    };
    document.getElementById("bitLength").oninput = function () {
      document.getElementById("bitValue").textContent = this.value;
    };
 
    async function generate() {
      const mode = document.getElementById("mode").value;
      const format = document.getElementById("format").value;
      const data = {
        mode,
        format,
        strict_validation: document.getElementById("strictValidation").checked,
        min_entropy: parseFloat(document.getElementById("minEntropy").value),
        max_compression: parseFloat(document.getElementById("maxCompression").value)
      };

      if (mode === "limited") {
        data.min = document.getElementById("min").value;
        data.max = document.getElementById("max").value;
        data.count = document.getElementById("count").value;
      } else {
        data.bits = document.getElementById("bitLength").value;
      }

      const res = await fetch('/generate', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      });

      const json = await res.json();
      output.textContent = JSON.stringify(json, null, 2);

      if (json.numbers) drawChart(json.numbers);
    }

    function exportResult() {
      const blob = new Blob([document.getElementById("output").textContent], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = "quantum_random_output.json";
      a.click();
      URL.revokeObjectURL(url);
    }

    let chart;
    function drawChart(data) {
      const ctx = document.getElementById('histogram').getContext('2d');
      const counts = {};
      data.forEach(n => counts[n] = (counts[n] || 0) + 1);
      const labels = Object.keys(counts);
      const values = Object.values(counts);

      if (chart) chart.destroy();
      chart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: labels,
          datasets: [{
            label: 'Frequency',
            data: values,
            backgroundColor: 'rgba(59,130,246,0.7)',
            borderRadius: 4,
          }]
        },
        options: {
          scales: {
            x: { title: { display: true, text: 'Values' } },
            y: { title: { display: true, text: 'Count' } }
          }
        }
      });
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    loadSettings();
  </script>
</body>
</html>
